---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { formatDate } from "../../lib/format";
import { getAllPosts, getPostBySlug } from "../../lib/posts";

export function getStaticPaths() {
  return getAllPosts().map((post) => ({ params: { slug: post.slug } }));
}

const slug = Astro.params.slug;
if (!slug) throw new Error("Missing slug param");

const post = getPostBySlug(slug);
if (!post) throw new Error(`Post not found: ${slug}`);

const PostContent = post.module.Content as any;
---

<BaseLayout title={post.title}>
  <article class="space-y-6">
    <header class="space-y-1">
      <h1 class="text-3xl font-bold tracking-tight">{post.title}</h1>
      <p class="text-sm text-slate-500">{formatDate(post.date)}</p>
    </header>

    <div class="prose prose-slate prose-sm sm:prose-base prose-headings:tracking-tight prose-p:my-3 prose-pre:rounded-lg prose-pre:bg-slate-900 prose-pre:text-slate-50">
      <PostContent />
    </div>
  </article>
</BaseLayout>
