---
import "../styles/global.css";
import { SITE } from "../lib/site";

type Props = {
  title?: string;
  description?: string;
};

const { title, description } = Astro.props;
const pageTitle = title ? `${title} · ${SITE.title}` : SITE.title;
const pageDescription = description ?? SITE.description;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700;900&display=swap"
      rel="stylesheet"
    />

    <title>{pageTitle}</title>
    {pageDescription && <meta name="description" content={pageDescription} />}

    <link rel="canonical" href={Astro.url} />
    <link rel="icon" href="/favicon.png" />

    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml" />

    <script>
      window.MathJax = {
        tex: {
          inlineMath: [["$", "$"], ["\\(", "\\)"]],
          displayMath: [["$$", "$$"], ["\\[", "\\]"]],
          macros: {
            Q: "\\mathbb{Q}",
            C: "\\mathbb{C}",
          },
        },
      };
    </script>
    <script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>

  <body>
    <a
      href="#content"
      class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-50 focus:rounded-md focus:bg-white focus:px-3 focus:py-2 focus:text-sm focus:font-medium focus:shadow"
    >
      Skip to content
    </a>

    <div class="pointer-events-none fixed inset-x-0 top-0 z-0 h-80 bg-gradient-to-b from-white to-cream"></div>

    <div class="relative z-10 min-h-screen flex flex-col">
      <header
        class="site-header sticky top-0 z-40 border-b border-slate-900/10 bg-white/85 shadow-sm backdrop-blur transition-all duration-300 ease-out motion-reduce:transition-none"
      >
        <div
          class="site-header-inner mx-auto flex max-w-[34rem] items-center justify-between gap-4 px-4 py-4 transition-all duration-300 ease-out motion-reduce:transition-none"
        >
          <a href="/" class="site-brand flex items-center gap-2 text-base font-semibold tracking-tight transition-all duration-300 ease-out">
            <img src="/favicon.png" alt="" class="site-brand-logo h-6 w-6 transition-all duration-300 ease-out" />
            <span>{SITE.title}</span>
          </a>

          <nav class="flex items-center gap-4 text-sm text-slate-600">
            <a href="/posts" class="hover:text-slate-900 hover:underline">Posts</a>
            <a href="/about" class="hover:text-slate-900 hover:underline">About</a>
          </nav>
        </div>
      </header>

      <div class="mx-auto w-full max-w-[34rem] flex-1 px-4 py-8">
        <main id="content" class="min-w-0 w-full">
          <slot />
        </main>
      </div>

      <footer class="mt-auto border-t border-slate-900/10">
        <div class="mx-auto max-w-sm px-4 py-10 text-sm text-slate-600">
          © {new Date().getFullYear()} {SITE.author}
        </div>
      </footer>
    </div>

    <script is:inline>
      (() => {
        const root = document.documentElement;
        const onThreshold = 24;
        const offThreshold = 0;

        let isScrolled = false;
        let rafId = 0;

        const apply = () => {
          rafId = 0;

          const y = window.scrollY || 0;

          if (!isScrolled && y > onThreshold) {
            isScrolled = true;
            root.classList.add("is-scrolled");
            return;
          }

          if (isScrolled && y <= offThreshold) {
            isScrolled = false;
            root.classList.remove("is-scrolled");
          }
        };

        const onScroll = () => {
          if (rafId) return;
          rafId = window.requestAnimationFrame(apply);
        };

        apply();
        window.addEventListener("scroll", onScroll, { passive: true });
      })();
    </script>
  </body>
</html>
